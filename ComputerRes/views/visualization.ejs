<!DOCTYPE html>
<html>
  <head>
    <title>Visualization</title>
    <link rel="stylesheet" href="/css/ol.css" type="text/css">
    <!-- The line below is only needed for old environments like Internet Explorer and Android 4.x -->
    <script src="/js/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>
    <script src="/js/ol.js"></script>
    <script src="/js/proj4.js"></script>
  </head>
  <body>
    <div id="notice">Rendering...</div> 
    <div id="map" class="map"></div>
    <script src="/js/jquery-1.10.2.min.js" ></script>
    <script>
      $.ajax({
        url : '/geodata/snapshot/<%=gdid %>',
        success : function(data){
          var resJson = JSON.parse(data);
          $('#notice').remove();
          if(resJson.dataType == 'geotiff'){
            proj4.defs('EPSG:4326', '+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees');
            var imageExtent = [resJson.layers[0].WSCorner[1], resJson.layers[0].WSCorner[0], resJson.layers[0].ENCorner[1], resJson.layers[0].ENCorner[0]];
            var map = new ol.Map({
              layers: [
                new ol.layer.Tile({
                  preload: Infinity,
                  source: new ol.source.BingMaps({
                    key: 'OrNDfeLj1aSai5JNZOJf~2m5izgCIEp4NiOIcw6O33A~ArtrHATsJqClTJ8rLQbXHt7AzVLgp-sei6gopAvyeAenikuDX0gYXn0bZJOD7CQ-',
                    imagerySet: 'Aerial'
                  })
                }),
                new ol.layer.Image({
                  source: new ol.source.ImageStatic({
                    url: '/images/snapshot/' + resJson.layers[0].name,
                    crossOrigin: '',
                    projection: 'EPSG:4326',
                    imageExtent: imageExtent
                  })
                })
              ],
              target: 'map',
              view: new ol.View({
                center:ol.proj.transform(ol.extent.getCenter(imageExtent), 'EPSG:4326', 'EPSG:3857'),
                zoom: 7
              })
            });
          }
        }
      });
    </script>
  </body>
</html>